{"version":3,"file":"api-d829b9a3.js","sources":["../../../../../../src/lib/api.js"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols\n\nimport { variables } from '$lib/variables'\n\nconst GLOBAL_TIMEOUT = 5000\nconst GLOBAL_RETRIES = 3\nconst GLOBAL_RETRY_DELAY = 100\n\nconst delay = delay => new Promise(resolve => setTimeout(() => resolve(), delay))\n\nconst fetchWithTimeout = async (resource, options = {}, f) => {\n\t//console.log(`fetchWithTimeout(${resource})`)\n\n\tlet id = null\n\tlet response\n\n\tif (typeof AbortController === 'function') {\n\t\tconst { timeout = GLOBAL_TIMEOUT } = options\n\t\tconst controller = new AbortController()\n\t\tid = setTimeout(() => controller.abort(), timeout)\n\n\t\tif (typeof f === 'function') {\n\t\t\t//console.log(`Server-side fetch ${resource}`)\n\t\t\tresponse = await f(resource, { ...options, signal: controller.signal })\n\t\t} else {\n\t\t\tresponse = await fetch(resource, { ...options, signal: controller.signal })\n\t\t}\n\t} else {\n\t\tif (typeof f === 'function') {\n\t\t\t//console.log(`Server-side fetch ${resource}`)\n\t\t\tresponse = await f(resource, options)\n\t\t} else {\n\t\t\tresponse = await fetch(resource, options)\n\t\t}\n\t}\n\n\tif (id !== null) {\n\t\tclearTimeout(id)\n\t}\n\n\treturn response\n}\n\nconst fetchWithRetryDelay = async (resource, options = {}, f, n = GLOBAL_RETRIES) => {\n\t//console.log(`fetchWithRetryDelay(${resource})`)\n\n\ttry {\n\t\treturn await fetchWithTimeout(resource, options, f)\n\t} catch(error) {\n\t\tconsole.error(error)\n\n\t\tif (n === 1) throw error\n\n\t\tawait delay(GLOBAL_RETRY_DELAY)\n\n\t\treturn fetchWithRetryDelay(resource, options, f, n - 1)\n\t}\n}\n\nexport const getSettings = (f, options) => fetchWithRetryDelay(`/settings`, options, f)\nexport const getVersion = (f, options) => fetchWithRetryDelay( variables.DEV ? 'https://emuos.emupedia.net/emuos/version.json' : '/emuos/version.json', options, f)"],"names":["GLOBAL_TIMEOUT","GLOBAL_RETRIES","GLOBAL_RETRY_DELAY","delay","resolve","fetchWithTimeout","resource","options","f","id","response","timeout","controller","fetchWithRetryDelay","n","error","getVersion","variables"],"mappings":"4CAIA,MAAMA,EAAiB,IACjBC,EAAiB,EACjBC,EAAqB,IAErBC,EAAQA,GAAS,IAAI,QAAQC,GAAW,WAAW,IAAMA,IAAWD,CAAK,CAAC,EAE1EE,EAAmB,MAAOC,EAAUC,EAAU,CAAA,EAAIC,IAAM,CAG7D,IAAIC,EAAK,KACLC,EAEJ,GAAI,OAAO,iBAAoB,WAAY,CAC1C,KAAM,CAAE,QAAAC,EAAUX,CAAc,EAAKO,EAC/BK,EAAa,IAAI,gBACvBH,EAAK,WAAW,IAAMG,EAAW,MAAK,EAAID,CAAO,EAE7C,OAAOH,GAAM,WAEhBE,EAAW,MAAMF,EAAEF,EAAU,CAAE,GAAGC,EAAS,OAAQK,EAAW,OAAQ,EAEtEF,EAAW,MAAM,MAAMJ,EAAU,CAAE,GAAGC,EAAS,OAAQK,EAAW,OAAQ,CAE7E,MACM,OAAOJ,GAAM,WAEhBE,EAAW,MAAMF,EAAEF,EAAUC,CAAO,EAEpCG,EAAW,MAAM,MAAMJ,EAAUC,CAAO,EAI1C,OAAIE,IAAO,MACV,aAAaA,CAAE,EAGTC,CACR,EAEMG,EAAsB,MAAOP,EAAUC,EAAU,CAAE,EAAEC,EAAGM,EAAIb,IAAmB,CAGpF,GAAI,CACH,OAAO,MAAMI,EAAiBC,EAAUC,EAASC,CAAC,CAClD,OAAOO,EAAN,CAGD,GAFA,QAAQ,MAAMA,CAAK,EAEfD,IAAM,EAAG,MAAMC,EAEnB,aAAMZ,EAAMD,CAAkB,EAEvBW,EAAoBP,EAAUC,EAASC,EAAGM,EAAI,CAAC,CACtD,CACF,EAGaE,EAAa,CAACR,EAAGD,IAAYM,EAAqBI,EAAU,IAAM,gDAAkD,sBAAuBV,EAASC,CAAC"}